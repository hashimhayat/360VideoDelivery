<h1 style="display: none">Receiver</h1>

<style>
    .rect {
        width: 80px;
        height: 80px;
        position: absolute;
        left: -1000px;
        top: -1000px;
    }
</style>

<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/aframe/0.6.0/aframe-master.js"></script> -->

<div style="display: none">Status: <span id="connection" >Disconnected.</span><br><br></div>


<video id="video" src="https://ucarecdn.com/fadab25d-0b3a-45f7-8ef5-85318e92a261/" style="width: 80%; height: 80%;"
               autoplay loop crossorigin="anonymous"></video>

<!-- <a-scene>
    <a-assets>
        <video id="video" src="https://ucarecdn.com/fadab25d-0b3a-45f7-8ef5-85318e92a261/" style="width: 80%; height: 80%;"
               autoplay loop crossorigin="anonymous"></video>
    </a-assets>
    <a-videosphere src="#video" rotation="0 180 0"></a-videosphere>
</a-scene> -->

  <div class="demo-frame">
    <div class="demo-container">
    </div>
  </div>


<script src="/javascripts/receiver.js" charset="utf-8"></script>
<script src="/javascripts/tracking-min.js"></script>

<script>

    const socket = io();

    window.onload = function() {

        var video = document.getElementById('video');
        var colors = new tracking.ColorTracker(['magenta']);

        var flashed = undefined;
        var signalReceived = undefined;

        socket.on('flashed', function(time) {
            flashed = time;
            signalReceived = Date.now();
            console.log("Flashed at: ", time);
        });

        colors.on('track', function(event) {
        
            if (event.data.length > 0) {

                let recvTime = Date.now();

                    if (signalReceived){
                        let tracker_delay = Date.now() - signalReceived;
                        console.log("Tracker Delay: ", tracker_delay);
                    }

                    if (flashed) {
                        let delay = recvTime - flashed - tracker_delay;
                        console.log("Delay: ", delay); 
                        flashed = undefined;
                        signalReceived = undefined;
                    }

            }
        });

        tracking.track('#video', colors);

      //   window.plot = function(x, y, w, h, color) {
      //       var rect = document.createElement('div');
      //       document.querySelector('.demo-container').appendChild(rect);
      //       rect.classList.add('rect');
      //       rect.style.border = '2px solid ' + color;
      //       rect.style.width = w + 'px';
      //       rect.style.height = h + 'px';
      //       rect.style.left = (100 + x) + 'px';
      //       rect.style.top = (100 + y) + 'px';
      // };
    };
</script>

